module parser_control

language framevm

// Fixture of minimal block
fixture [[MAIN:
	[[...]]
]]


test return  [[return]]     parse succeeds
test ccall   [[ccall LBL1]] parse succeeds
test cret    [[cret]]       parse succeeds
test try     [[try LBL]]    parse succeeds
test throw   [[throw]]      parse succeeds


test jump simple     [[jump P]]    parse succeeds
test jump simple2    [[jump G]]    parse succeeds
test jump number     [[jump 0]]    parse fails
test jump lower      [[jump e]]    parse fails
test jump r          [[jump r]]    parse fails
test jump c          [[jump c]]    parse fails
test jump x          [[jump x]]    parse fails
test jump char       [[jump 'x']]  parse fails


test jumpz single label    [[jumpz P]]      parse fails

test jumpz lbl1 simple     [[jumpz P P]]    parse succeeds
test jumpz lbl1 simple2    [[jumpz G P]]    parse succeeds
test jumpz lbl1 number     [[jumpz 0 P]]    parse fails
test jumpz lbl1 lower      [[jumpz e P]]    parse fails
test jumpz lbl1 r          [[jumpz r P]]    parse fails
test jumpz lbl1 c          [[jumpz c P]]    parse fails
test jumpz lbl1 x          [[jumpz x P]]    parse fails
test jumpz lbl1 char       [[jumpz 'x' P]]  parse fails

test jumpz lbl2 simple     [[jumpz P P]]    parse succeeds
test jumpz lbl2 simple2    [[jumpz P G]]    parse succeeds
test jumpz lbl2 number     [[jumpz P 0]]    parse fails
test jumpz lbl2 lower      [[jumpz P e]]    parse fails
test jumpz lbl2 r          [[jumpz P r]]    parse fails
test jumpz lbl2 c          [[jumpz P c]]    parse fails
test jumpz lbl2 x          [[jumpz P x]]    parse fails
test jumpz lbl2 char       [[jumpz P 'x']]  parse fails



test call no label         [[call]]         parse fails

test call single simple    [[call P]]       parse succeeds
test call single simple2   [[call G]]       parse succeeds
test call single number    [[call 0]]       parse fails
test call single lower     [[call e]]       parse fails
test call single r         [[call r]]       parse fails
test call single c         [[call c]]       parse fails
test call single x         [[call x]]       parse fails
test call single char      [[call 'x']]     parse fails

test call lbl1 simple      [[call P P]]     parse succeeds
test call lbl1 simple2     [[call G P]]     parse succeeds
test call lbl1 number      [[call 0 P]]     parse fails
test call lbl1 lower       [[call e P]]     parse fails
test call lbl1 r           [[call r P]]     parse fails
test call lbl1 c           [[call c P]]     parse fails
test call lbl1 x           [[call x P]]     parse fails
test call lbl1 char        [[call 'x' P]]   parse fails

test call lbl2 simple      [[call P P]]     parse succeeds
test call lbl2 simple2     [[call P G]]     parse succeeds
test call lbl2 number      [[call P 0]]     parse fails
test call lbl2 lower       [[call P e]]     parse fails
test call lbl2 r           [[call P r]]     parse fails
test call lbl2 c           [[call P c]]     parse fails
test call lbl2 x           [[call P x]]     parse fails
test call lbl2 char        [[call P 'x']]   parse fails



test try lbl1 simple       [[try P P P]]    parse succeeds
test try lbl1 simple2      [[try G P Q]]    parse succeeds
test try lbl1 number       [[try 0 P P]]    parse fails
test try lbl1 lower        [[try e P P]]    parse fails
test try lbl1 r            [[try r P P]]    parse fails
test try lbl1 c            [[try c P P]]    parse fails
test try lbl1 x            [[try x P P]]    parse fails
test try lbl1 char         [[try 'x' P P]]  parse fails

test try lbl2 simple2      [[try P G P]]    parse succeeds
test try lbl2 number       [[try P 0 P]]    parse fails
test try lbl2 lower        [[try P e P]]    parse fails
test try lbl2 r            [[try P r P]]    parse fails
test try lbl2 c            [[try P c P]]    parse fails
test try lbl2 x            [[try P x P]]    parse fails
test try lbl2 char         [[try P 'x' P]]  parse fails

test try lbl2 simple2      [[try P P G]]    parse succeeds
test try lbl2 number       [[try P P 0]]    parse fails
test try lbl2 lower        [[try P P e]]    parse fails
test try lbl2 r            [[try P P r]]    parse fails
test try lbl2 c            [[try P P c]]    parse fails
test try lbl2 x            [[try P P x]]    parse fails
test try lbl2 char         [[try P P 'x']]  parse fails


test newscope no label         [[newscope]]         parse fails

test newscope single simple    [[newscope P LBL]]       parse succeeds
test newscope single simple2   [[newscope G LBL]]       parse succeeds
test newscope single number    [[newscope 0 LBL]]       parse fails
test newscope single lower     [[newscope e LBL]]       parse fails
test newscope single r         [[newscope r LBL]]       parse fails
test newscope single c         [[newscope c LBL]]       parse fails
test newscope single x         [[newscope x LBL]]       parse fails
test newscope invalid lbl      [[newscope x 0]]         parse fails



test exitscope simple         [[exitscope [] P]]          parse succeeds
test exitscope path single    [[exitscope [P] P]]         parse succeeds
test exitscope path multiple  [[exitscope [C, 0] G]]      parse succeeds
test exitscope path multiple2 [[exitscope [I, 0, L] Q]]   parse succeeds

test exitscope path lower     [[exitscope [e, P] P]]   parse fails
test exitscope path r         [[exitscope [r] P]]   parse fails
test exitscope path x         [[exitscope [x] P]]   parse fails
test exitscope path c         [[exitscope [c] P]]   parse fails
test exitscope path negative  [[exitscope [-1] P]]  parse fails
test exitscope no path        [[exitscope P]]       parse fails

test exitscope lbl number     [[exitscope [] 0]]    parse fails
test exitscope lbl lower      [[exitscope [] e]]    parse fails
test exitscope lbl r          [[exitscope [] r]]    parse fails
test exitscope lbl c          [[exitscope [] c]]    parse fails
test exitscope lbl x          [[exitscope [] x]]    parse fails
test exitscope lbl char       [[exitscope [] 'x']]  parse fails
test exitscope no lbl         [[exitscope [] ]]     parse fails