module smoke_superclasses

language framevm

test Superclasses example RISC [[MAIN:
	new 1
	scopedown MAIN2

MAIN2:
	new
	dup
	new 1
	dup
	link [] P
	linkr P
	set [0]
	ipush 1
	set [0, P, 0]
	new 1
	dup
	link [0] P
	dup
	ipush 2
	setr [0]
	
	call FUNC_2 MAIN_CONT
	
MAIN_CONT:	
	new 2
	dup
	link [0, P] P
	
	dup
	ipush 1
	setr [0]
	
	dup
	get [r]
	setr [1]
	call FUNC_1 MAIN_CONT2
	
MAIN_CONT2:
	get [r]
	set [0]
	get [0, 0]
	print
	get [0, 1]
	print
	ipush 0
	return
	
FUNC_2:
	get [0]
	ipush 1
	addi
	return
	
FUNC_1:
	new 2
	dup
	link [P,P] P
	dup
	get [0]
	setr [0]
	dup
	get [1]
	get [P, 0]
	addi
	setr [1]
	return
]] transform "Run -> RISC" to "1
4"

test Superclasses example CISC[[MAIN:
	new 1
	scopedown MAIN2

MAIN2:
	new
	dup
	new 1
	dup
	link [] P
	linkr P
	set [0]
	ipush 1
	set [0, P, 0]
	new 1
	dup
	link [0] P
	dup
	ipush 2
	setr [0]
	
	call FUNC_2 MAIN_CONT
	
MAIN_CONT:	
	new 2
	dup
	link [0, P] P
	
	dup
	ipush 1
	setr [0]
	
	dup
	get [r]
	setr [1]
	call FUNC_1 MAIN_CONT2
	
MAIN_CONT2:
	get [r]
	set [0]
	get [0, 0]
	print
	get [0, 1]
	print
	ipush 0
	return
	
FUNC_2:
	get [0]
	ipush 1
	addi
	return
	
FUNC_1:
	new 2
	dup
	link [P,P] P
	dup
	get [0]
	setr [0]
	dup
	get [1]
	get [P, 0]
	addi
	setr [1]
	return
]] transform "Run -> CISC" to "1
4"
	