module syntax_instructions

language framevm

// Fixture of minimal block
fixture [[MAIN:
	[[...]]
	return
]]


test ipush correct  [[ipush 1]]     parse succeeds
test ipush negative [[ipush -1]]    parse succeeds
test ipush large    [[ipush 123459876]] parse succeeds

test ipush empty    [[ipush ]]      parse fails
test ipush char     [[ipush 'a']]   parse fails
test ipush sum      [[ipush 1+1]]   parse fails


test addi  [[addi]]     parse succeeds
test eqi   [[eqi]]      parse succeeds
test lti   [[lti]]      parse succeeds

test dup   [[dup]]      parse succeeds
test swap  [[swap]]     parse succeeds
test print [[print]]    parse succeeds
test debug [[debug]]    parse succeeds


test dupn correct  [[dup 2]]     parse succeeds
test dupn negative [[dup -1]]    parse fails
test dupn zero     [[dup 0]]     parse fails
test dupn one      [[dup 1]]     parse succeeds
test dupn large    [[dup 123]]   parse succeeds

test swapn correct  [[swap 2]]     parse succeeds
test swapn negative [[swap -1]]    parse fails
test swapn zero     [[swap 0]]     parse fails
test swapn one      [[swap 1]]     parse succeeds
test swapn large    [[swap 123]]   parse succeeds


test new     [[new]]     parse succeeds
test set     [[set]]     parse succeeds
test setr    [[setr]]    parse succeeds
test get     [[get]]     parse succeeds
test getr    [[getr]]    parse succeeds

test link simple         [[link [] P]]          parse succeeds
test link path single    [[link [P] P]]         parse succeeds
test link path multiple  [[link [C, 0] G]]      parse succeeds
test link path multiple2 [[link [I, 0, L] Q]]   parse succeeds

test link path lower     [[link [e, P] P]]   parse fails
test link path r         [[link [r, P] P]]   parse fails
test link path x         [[link [x] P]]      parse fails
test link path c         [[link [c] P]]      parse fails
test link path c         [[link [pp] P]]     parse fails
test link path negative  [[link [-1] P]]     parse fails
test link no path        [[link P]]          parse fails

test link lbl number     [[link [] 0]]   parse fails
test link lbl lower      [[link [] e]]   parse fails
test link lbl r          [[link [] r]]   parse fails
test link lbl c          [[link [] c]]   parse fails
test link lbl x          [[link [] x]]   parse fails
test link lbl char       [[link [] 'x']] parse fails
test link no lbl         [[link [] ]]    parse fails


test linkr simple     [[linkr P]]   parse succeeds
test linkr simple2    [[linkr G]]   parse succeeds
test linkr number     [[linkr 0]]   parse fails
test linkr lower      [[linkr e]]   parse fails
test linkr r          [[linkr r]]   parse fails
test linkr c          [[linkr c]]   parse fails
test linkr x          [[linkr x]]   parse fails
test linkr char       [[linkr 'x']] parse fails


test set simple          [[set [] ]]          parse succeeds
test set path single     [[set [P] ]]         parse succeeds
test set path multiple   [[set [C, 0] ]]      parse succeeds
test set path multiple2  [[set [I, 0, L] ]]   parse succeeds

test set path lower      [[set [e, P] ]]   parse fails
test set path r          [[set [r] ]]      parse fails
test set path x          [[set [x] ]]      parse fails
test set path c          [[set [c] ]]      parse fails
test set path negative   [[set [-1] ]]     parse fails


test setr simple         [[setr [] ]]         parse succeeds
test setr path single    [[setr [P] ]]        parse succeeds
test setr path multiple  [[setr [C, 0] ]]     parse succeeds
test setr path multiple2 [[setr [I, 0, L] ]]  parse succeeds

test setr path lower     [[setr [e, P] ]]  parse fails
test setr path r         [[setr [r] ]]     parse fails
test setr path x         [[setr [x] ]]     parse fails
test setr path c         [[setr [c] ]]     parse fails
test setr path negative  [[setr [-1] ]]    parse fails


test get simple          [[get [] ]]          parse succeeds
test get path single     [[get [P] ]]         parse succeeds
test get path multiple   [[get [C, 0] ]]      parse succeeds
test get path multiple2  [[get [I, 0, L] ]]   parse succeeds

test get path lower      [[get [e, P] ]]   parse fails
test get path r          [[get [r] ]]      parse fails
test get path x          [[get [x] ]]      parse fails
test get path c          [[get [c] ]]      parse fails
test get path negative   [[get [-1] ]]     parse fails


test getr simple         [[getr [] ]]         parse succeeds
test getr path single    [[getr [P] ]]        parse succeeds
test getr path multiple  [[getr [C, 0] ]]     parse succeeds
test getr path multiple2 [[getr [I, 0, L] ]]  parse succeeds

test getr path lower     [[getr [e, P] ]]  parse fails
test getr path r         [[getr [r] ]]     parse fails
test getr path x         [[getr [x] ]]     parse fails
test getr path c         [[getr [c] ]]     parse fails
test getr path negative  [[getr [-1] ]]    parse fails


test cnew simple      [[cnew LBL 0]]  parse succeeds
test cnew negative    [[cnew LBL -1]] parse fails
test cnew only label  [[cnew LBL]]    parse fails
test cnew closure     [[cnew]]        parse succeeds