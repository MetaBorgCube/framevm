module stc_interpreter_frame_slots

language framevm

fixture [[MAIN:
	stack := 99
	[[...]]
	print
	ipush 0
	return
]]

test new no slots[[
	new
	dup
	ipush 10
	setr [0]
	getr [0]
]] transform "Run -> Run" to "FAIL"

test new one slot 1[[
	new 1
	dup
	ipush 10
	setr [0]
	getr [0]
]] transform "Run -> Run" to "IntV(10)"

test new one slot 2[[
	new 1
	dup
	ipush 10
	setr [1]
	getr [1]
]] transform "Run -> Run" to "FAIL"

test new two slots 1[[
	new 2
	dup
	ipush 10
	setr [1]
	getr [0]
]] transform "Run -> Run" to "FAIL"

test new two slots 2[[
	new 2
	dup
	ipush 10
	setr [1]
	getr [1]
]] transform "Run -> Run" to "IntV(10)"

test newr one slot 1[[
	ipush 1
	newr
	dup
	ipush 10
	setr [0]
	getr [0]
]] transform "Run -> Run" to "IntV(10)"

test newr one slot 2[[
	ipush 1
	newr
	dup
	ipush 10
	setr [1]
	getr [1]
]] transform "Run -> Run" to "FAIL"

test newr two slots 1[[
	ipush 2
	newr
	dup
	ipush 10
	setr [1]
	getr [0]
]] transform "Run -> Run" to "FAIL"

test newr two slots 2[[
	ipush 2
	newr
	dup
	ipush 10
	setr [1]
	getr [1]
]] transform "Run -> Run" to "IntV(10)"

