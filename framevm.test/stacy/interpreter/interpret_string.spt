module stc_interpreter_string

language framevm

fixture [[MAIN:
	stack := 99
	[[...]]

EXIT:
	ipush 0
	return
	
PRINT:
	stack := 4
	get [0]
	ipush 0
	jump PRINT_LOOP
	
PRINT_LOOP:
	dup 2
	dup 2
	eqi
	jumpz PRINT_CHAR PRINT_END
	
PRINT_END:
	pop
	pop
	cget [c]
	cret
	
PRINT_CHAR:
	ipush 1
	addi
	dup
	get
	printc
	jump PRINT_LOOP
]]

test Hello World! [[
	spush "Hello World!"
	call PRINT EXIT
]] transform "Run -> Run" to "Hello World!"

test Hello World newline [[
	spush "Hello\nWorld!"
	call PRINT EXIT
]] transform "Run -> Run" to "Hello
World!"

test print char unicode [[
	ipush 128539
	printc
	jump EXIT
]] transform "Run -> Run" to "ï˜›"

test print char [[
	ipush 65
	printc
	jump EXIT
]] transform "Run -> Run" to "A"

test print char [[
	cpush 'A'
	printc
	jump EXIT
]] transform "Run -> Run" to "A"

test print char 2 [[
	cpush 'Q'
	printc
	jump EXIT
]] transform "Run -> Run" to "Q"

test print char whitespace [[
	cpush ' '
	printc
	cpush 'B'
	printc
	cpush ' '
	printc
	cpush 'C'
	printc
	cpush ' '
	printc
	jump EXIT
]] transform "Run -> Run" to " B C "


test empty string 1 [[
	new 1
	dup
	ipush 0
	setr [0]
	call PRINT EXIT
]] transform "Run -> Run" to ""

test empty string 2 [[
	spush ""
	call PRINT EXIT
]] transform "Run -> Run" to ""
