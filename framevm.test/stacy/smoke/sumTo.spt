module smoke_sum_to

language framevm

test Sum to example RISC [[MAIN:
	new 1
	dup
	link [] P
	dup
	ipush 42
	setr [0]
	call SUMTO MAIN_END

SUMTO:
  	get [0]
  	ipush 0
  	eqi
	jumpz SUMTO_ELSE SUMTO_THEN

SUMTO_THEN:
	ipush 0
	return
	
SUMTO_ELSE:
	new 1
	dup
	link [P] P
	
	dup
	ipush -1
	get [0]
	addi
	setr [0]
	
	call SUMTO SUMTO_RETURN

SUMTO_RETURN:
	rget
	get [0]
	addi
	return
	
MAIN_END:
	rget
	print
	ipush 0
	return
]] transform "Run -> RISC" to "IntV(903)"

test Sum to example CISC [[MAIN:
	new 1
	dup
	link [] P
	dup
	ipush 42
	setr [0]
	call SUMTO MAIN_END

SUMTO:
  	get [0]
  	ipush 0
  	eqi
	jumpz SUMTO_ELSE SUMTO_THEN

SUMTO_THEN:
	ipush 0
	return
	
SUMTO_ELSE:
	new 1
	dup
	link [P] P
	
	dup
	ipush -1
	get [0]
	addi
	setr [0]
	
	call SUMTO SUMTO_RETURN

SUMTO_RETURN:
	rget
	get [0]
	addi
	return
	
MAIN_END:
	rget
	print
	ipush 0
	return
]] transform "Run -> CISC" to "IntV(903)"
