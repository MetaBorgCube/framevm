module smoke_add

language framevm


test Add example [[ADD:
	stack := 2
  	get [0]
  	get [1]
  	addi
  	return

MAIN:
	stack := 3
	new 1
	newscope P MAIN2
	
MAIN2:
	ipush 10
	set [0]
	new 2
	dup
	link [] P
	dup
	ipush 1
	setr [0]
	dup
	ipush 3
	setr [1]
	call ADD CONT2
	
CONT2:
	rget
	print
	ipush 0
	return
]] transform "Run -> Run" to "IntV(4)"
